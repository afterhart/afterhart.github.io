<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AFTERHART — Main</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>


  <aside class="sidebar" aria-label="Primary">
    <div class="brand">AFTERHART</div>

    <nav class="nav" aria-label="Main navigation">
      <ul>
        <li><a href="index.html" data-page="main">Main</a></li>
        <li><a href="catalog.html" data-page="catalog">Catalog</a></li>
        <li><a href="gallery.html" data-page="gallery">Gallery</a></li>
        <li><a href="bio.html" data-page="bio">Bio</a></li>
      </ul>
    </nav>
  </aside>

  <main id="main" class="main" role="main" tabindex="-1">
    <section class="hero" aria-hidden="false">
      <!-- Видео-плеер — muted, autoplay, loop, playsinline -->
      <video id="hero-video" class="hero-video" autoplay muted loop playsinline preload="auto" poster="poster.jpg" aria-label="Background video">
        <source src="intro1.mp4" type="video/mp4" />
        Your browser does not support the video tag.
      </video>
    </section>

    <!-- Ниже — каталог/карточки -->
    <section class="catalog" aria-label="Catalog">
      <div class="grid">
        <article class="item">
          <a href="look1.html">
            <img src="look1.jpg" alt="ANGEL I" loading="lazy" />
            <p>ANGEL I</p>
          </a>
        </article>
        <article class="item">
          <a href="look2.html">
            <img src="look2.jpg" alt="MATTHEW 16:19" loading="lazy" />
            <p>MATTHEW 16:19</p>
          </a>
        </article>
        <article class="item">
          <a href="look3.html">
            <img src="look3.jpg" alt="KETA JACKET" loading="lazy" />
            <p>KETA JACKET</p>
          </a>
        </article>
        <article class="item">
          <a href="look4.html">
            <img src="look4.jpg" alt="RUST BELT" loading="lazy" />
            <p>RUST BELT</p>
          </a>
        </article>
      </div>
    </section>
  </main>

 <script>
(function () {
  const mapPathToPage = (p) => {
    if (!p || p === '/' || p === '/index.html') return 'main';
    const name = p.split('/').pop().toLowerCase();
    if (name === 'index.html' || name === '') return 'main';
    return name.replace('.html', '');
  };

  const links = document.querySelectorAll('.nav a[data-page]');

  const setActive = (page) => {
    links.forEach(a => {
      const isActive = a.dataset.page === page;
      a.classList.toggle('active', isActive);
      if (isActive) a.setAttribute('aria-current', 'page');
      else a.removeAttribute('aria-current');
    });
  };

  // Ставим исходный active по URL (как раньше)
  const current = mapPathToPage(window.location.pathname);
  setActive(current);

  // При клике подчёркиваем до перехода
  links.forEach(a => {
    a.addEventListener('click', () => {
      setActive(a.dataset.page);
    });
  });

  // Секция hero (видео) и catalog (фотографии)
  const hero = document.querySelector('.hero');
  const catalog = document.querySelector('.catalog');

  // Логика: если секция полностью видна (intersectionRatio близко к 1) — делаем её активной.
  // Для большей надёжности используем порог 0.99 (иногда точный 1.0 ненадёжен).
  if ('IntersectionObserver' in window && hero && catalog) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.target === catalog && entry.intersectionRatio >= 0.99) {
          // Фото полностью видны -> catalog active
          setActive('shop'); // data-page="shop" у пункта Catalog
        }
        if (entry.target === hero && entry.intersectionRatio >= 0.99) {
          // Видео полностью видно -> main active
          setActive('main');
        }
      });
    }, {
      root: null,
      threshold: [0.0, 0.5, 0.99]
    });

    observer.observe(catalog);
    observer.observe(hero);
  } else if (hero && catalog) {
    // Fallback: проверяем при скролле — считается "полностью видно", если top >=0 и bottom <= viewport height
    const isFullyVisible = (el) => {
      const r = el.getBoundingClientRect();
      const vh = window.innerHeight || document.documentElement.clientHeight;
      return r.top >= 0 && r.bottom <= vh;
    };

    const onScroll = () => {
      if (isFullyVisible(catalog)) setActive('shop');
      else if (isFullyVisible(hero)) setActive('main');
    };

    window.addEventListener('scroll', onScroll, { passive: true });
    // и один запуск при загрузке
    onScroll();
  }

  // Поддержка навигации назад/вперёд — сохраняем подсветку по URL
  window.addEventListener('popstate', () => {
    setActive(mapPathToPage(window.location.pathname));
  });
})();
</script>

</body>
</html>




































