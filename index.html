<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AFTERHART — Main</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>


  <aside class="sidebar" aria-label="Primary">
    <div class="brand">AFTERHART</div>

    <nav class="nav" aria-label="Main navigation">
      <ul>
        <li><a href="index.html" data-page="main">Main</a></li>
        <li><a href="catalog.html" data-page="catalog">Catalog</a></li>
        <li><a href="gallery.html" data-page="gallery">Gallery</a></li>
        <li><a href="bio.html" data-page="bio">Bio</a></li>
      </ul>
    </nav>
  </aside>

  <main id="main" class="main" role="main" tabindex="-1">
    <section class="hero" aria-hidden="false">
      <!-- Видео-плеер — muted, autoplay, loop, playsinline -->
      <video id="hero-video" class="hero-video" autoplay muted loop playsinline preload="auto" poster="poster.jpg" aria-label="Background video">
        <source src="intro1.mp4" type="video/mp4" />
        Your browser does not support the video tag.
      </video>
    </section>

    <!-- Ниже — каталог/карточки -->
    <section class="catalog" aria-label="Catalog">
      <div class="grid">
        <article class="item">
          <a href="look1.html">
            <img src="look1.jpg" alt="ANGEL I" loading="lazy" />
            <p>ANGEL I</p>
          </a>
        </article>
        <article class="item">
          <a href="look2.html">
            <img src="look2.jpg" alt="MATTHEW 16:19" loading="lazy" />
            <p>MATTHEW 16:19</p>
          </a>
        </article>
        <article class="item">
          <a href="look3.html">
            <img src="look3.jpg" alt="KETA JACKET" loading="lazy" />
            <p>KETA JACKET</p>
          </a>
        </article>
        <article class="item">
          <a href="look4.html">
            <img src="look4.jpg" alt="RUST BELT" loading="lazy" />
            <p>RUST BELT</p>
          </a>
        </article>
      </div>
    </section>
  </main>

<script>
(function () {
  const links = document.querySelectorAll('.nav a[data-page]');
  const setActive = (page) => {
    links.forEach(a => {
      const isActive = a.dataset.page === page;
      a.classList.toggle('active', isActive);
      if (isActive) a.setAttribute('aria-current', 'page');
      else a.removeAttribute('aria-current');
    });
  };

  // исходная подсветка по URL
  const mapPathToPage = (p) => {
    if (!p || p === '/' || p === '/index.html') return 'main';
    const name = p.split('/').pop().toLowerCase();
    if (name === 'index.html' || name === '') return 'main';
    return name.replace('.html', '');
  };
  setActive(mapPathToPage(window.location.pathname));

  // клики — мгновенно подсвечиваем
  links.forEach(a => a.addEventListener('click', () => setActive(a.dataset.page)));

  const hero = document.querySelector('.hero');
  const gridItems = Array.from(document.querySelectorAll('.grid .item'));

  // Если сетки или hero нет — выходим
  if (!hero || !gridItems.length) return;

  // Функция: находит элементы первой строки (по минимальному top)
  const getFirstRowItems = () => {
    const rects = gridItems.map(it => it.getBoundingClientRect());
    const tops = rects.map(r => r.top);
    const minTop = Math.min(...tops);
    const EPS = 2; // погрешность в пикселях (чтобы избежать дробных погрешностей)
    return gridItems.filter((it, i) => Math.abs(rects[i].top - minTop) <= EPS);
  };

  const isElementFullyVisible = (el) => {
    const r = el.getBoundingClientRect();
    const vh = window.innerHeight || document.documentElement.clientHeight;
    return r.top >= 0 && r.bottom <= vh;
  };

  const isFirstRowFullyVisible = () => {
    const firstRow = getFirstRowItems();
    if (!firstRow.length) return false;
    // верх первой строки и низ
    const rects = firstRow.map(el => el.getBoundingClientRect());
    const top = Math.min(...rects.map(r => r.top));
    const bottom = Math.max(...rects.map(r => r.bottom));
    const vh = window.innerHeight || document.documentElement.clientHeight;
    return top >= 0 && bottom <= vh;
  };

  // Throttled scroll/resize handler через requestAnimationFrame
  let ticking = false;
  const check = () => {
    ticking = false;

    // если первая строка полностью видна — активируем Catalog (data-page="shop")
    if (isFirstRowFullyVisible()) {
      setActive('shop');
      return;
    }

    // иначе, если видео полностью видно — активируем Main
    if (isElementFullyVisible(hero)) {
      setActive('main');
      return;
    }

    // иначе оставляем текущую подсветку (ничего не меняем)
  };

  const onScrollOrResize = () => {
    if (!ticking) {
      requestAnimationFrame(check);
      ticking = true;
    }
  };

  window.addEventListener('scroll', onScrollOrResize, { passive: true });
  window.addEventListener('resize', onScrollOrResize);
  // проверка при загрузке
  window.addEventListener('load', onScrollOrResize);
  // и однократная начальная проверка
  onScrollOrResize();

  // поддержка history (back/forward)
  window.addEventListener('popstate', () => setActive(mapPathToPage(window.location.pathname)));
})();
</script>

</body>
</html>






































