<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AFTERHART — Main</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>


  <aside class="sidebar" aria-label="Primary">
    <div class="brand">AFTERHART</div>

    <nav class="nav" aria-label="Main navigation">
      <ul>
        <li><a href="index.html" data-page="main">Main</a></li>
        <li><a href="catalog.html" data-page="catalog">Catalog</a></li>
        <li><a href="gallery.html" data-page="gallery">Gallery</a></li>
        <li><a href="bio.html" data-page="bio">Bio</a></li>
      </ul>
    </nav>
  </aside>

  <main id="main" class="main" role="main" tabindex="-1">
    <section class="hero" aria-hidden="false">
      <!-- Видео-плеер — muted, autoplay, loop, playsinline -->
      <video id="hero-video" class="hero-video" autoplay muted loop playsinline preload="auto" poster="poster.jpg" aria-label="Background video">
        <source src="intro1.mp4" type="video/mp4" />
        Your browser does not support the video tag.
      </video>
    </section>

    <!-- Ниже — каталог/карточки -->
    <section class="catalog" aria-label="Catalog">
      <div class="grid">
        <article class="item">
          <a href="look1.html">
            <img src="look1.jpg" alt="ANGEL I" loading="lazy" />
            <p>ANGEL I</p>
          </a>
        </article>
        <article class="item">
          <a href="look2.html">
            <img src="look2.jpg" alt="MATTHEW 16:19" loading="lazy" />
            <p>MATTHEW 16:19</p>
          </a>
        </article>
        <article class="item">
          <a href="look3.html">
            <img src="look3.jpg" alt="KETA JACKET" loading="lazy" />
            <p>KETA JACKET</p>
          </a>
        </article>
        <article class="item">
          <a href="look4.html">
            <img src="look4.jpg" alt="RUST BELT" loading="lazy" />
            <p>RUST BELT</p>
          </a>
        </article>
      </div>
    </section>
  </main>

<script>
(function () {
  const links = document.querySelectorAll('.nav a[data-page]');
  const setActive = (page) => {
    links.forEach(a => {
      const isActive = a.dataset.page === page;
      a.classList.toggle('active', isActive);
      if (isActive) a.setAttribute('aria-current', 'page');
      else a.removeAttribute('aria-current');
    });
  };

  // исходная подсветка по URL
  const mapPathToPage = (p) => {
    if (!p || p === '/' || p === '/index.html') return 'main';
    const name = p.split('/').pop().toLowerCase();
    if (name === 'index.html' || name === '') return 'main';
    return name.replace('.html', '');
  };
  setActive(mapPathToPage(window.location.pathname));

  // клики — мгновенно подсвечиваем
  links.forEach(a => a.addEventListener('click', () => setActive(a.dataset.page)));

  const hero = document.querySelector('.hero');
  const catalog = document.querySelector('.catalog');
  if (!hero || !catalog) return;

  // Порог видимости (0..1). 0.6 = 60% видимости считается "видно".
  const VISIBLE_THRESHOLD = 0.6;

  if ('IntersectionObserver' in window) {
    const observer = new IntersectionObserver((entries) => {
      let heroRatio = 0;
      let catalogRatio = 0;
      entries.forEach(entry => {
        if (entry.target === hero) heroRatio = entry.intersectionRatio;
        if (entry.target === catalog) catalogRatio = entry.intersectionRatio;
      });

      // debug:
      // console.log('heroRatio=', heroRatio.toFixed(2), 'catalogRatio=', catalogRatio.toFixed(2));

      // Если каталог достаточно виден — делаем Catalog активным.
      if (catalogRatio >= VISIBLE_THRESHOLD) {
        setActive('shop'); // data-page="shop" у Catalog
        return;
      }

      // Если видео достаточно виден — делаем Main активным.
      if (heroRatio >= VISIBLE_THRESHOLD) {
        setActive('main');
        return;
      }

      // Иначе — оставляем текущее (не переключаем)
    }, {
      root: null,
      threshold: [0, 0.25, 0.5, 0.6, 0.75, 1.0]
    });

    observer.observe(hero);
    observer.observe(catalog);
  } else {
    // fallback — простой scroll-check
    const vh = () => window.innerHeight || document.documentElement.clientHeight;
    const getRatio = (el) => {
      const r = el.getBoundingClientRect();
      const visibleHeight = Math.max(0, Math.min(r.bottom, vh()) - Math.max(r.top, 0));
      return visibleHeight / r.height;
    };
    const onScroll = () => {
      const heroRatio = getRatio(hero);
      const catalogRatio = getRatio(catalog);
      // console.log('fallback hero=', heroRatio, 'catalog=', catalogRatio);
      if (catalogRatio >= VISIBLE_THRESHOLD) setActive('shop');
      else if (heroRatio >= VISIBLE_THRESHOLD) setActive('main');
    };
    window.addEventListener('scroll', onScroll, { passive: true });
    onScroll();
  }

  // поддержка back/forward
  window.addEventListener('popstate', () => setActive(mapPathToPage(window.location.pathname)));
})();
</script>

</body>
</html>





































